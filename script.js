// --- PRODUCT DATA (from app.component.ts) ---

const qrProducts = [
  {
      id: 1,
      name: 'QR Ch·ªØ r∆°i (c√≥ ·∫£nh)',
      price: 159000,
      tag: 'Hot üî•üî•üî•',
      tagClass: 'bg-red-500 text-white',
      imageUrl: 'images/wordimg.jpg',
      videoUrl: 'images/wordimg.mp4',
      detailImages: [
        'images/wordimg.mp4',
      ],
      description: [
        "qu√©t qr sau ƒë√≥ ch·∫°m v√†o m√†n nh·∫°c s·∫Ω ƒë∆∞·ª£c ph√°t"
      ],
      features: [
        'M·ªói c√¢u 4-6 t·ª´',
        'Ch·ªØ, nh·∫°c, ·∫£nh theo y√™u c·∫ßu',
        'H·ªó tr·ª£ ch·ªânh s·ª≠a trong 24h'
      ],
    },
    {
      id: 7,
      name: 'QR ƒê·∫øm ng∆∞·ª£c',
      price: 159000,
      tag: 'Hot üî•üî•üî•',
      tagClass: 'bg-red-500 text-white',
      imageUrl: 'images/matrixrain.jpg',
      videoUrl: 'images/matrixrain.mp4',
      detailImages: [
        'images/matrixrain.jpg',
        'images/matrixrain.mp4',
      ],
       description: [
        "qu√©t qr sau ƒë√≥ ch·∫°m v√†o m√†n nh·∫°c s·∫Ω ƒë∆∞·ª£c ph√°t"
      ],
      features: [
        'M·ªói c√¢u 4-6 t·ª´',
        'Ch·ªØ, nh·∫°c theo y√™u c·∫ßu',
        'H·ªó tr·ª£ ch·ªânh s·ª≠a trong 24h'
      ],
    },
    {
      id: 2,
      name: 'QR Ch·ªØ r∆°i',
      price: 159000,
      tag: 'Best Seller',
      tagClass: 'bg-blue-500 text-white',
      imageUrl: 'images/wordrain.jpg',
      videoUrl: 'images/wordrain.mp4',
      detailImages: ['images/wordrain.mp4'],
       description: [
        "qu√©t qr sau ƒë√≥ ch·∫°m v√†o m√†n nh·∫°c s·∫Ω ƒë∆∞·ª£c ph√°t"
      ],
      features: [
        'M·ªói c√¢u 4-6 t·ª´',
        'Ch·ªØ, nh·∫°c theo y√™u c·∫ßu',
        'H·ªó tr·ª£ ch·ªânh s·ª≠a trong 24h'
      ],
    },
    {
      id: 3,
      name: 'QR Th∆∞ l·ªùi nh·∫Øn',
      price: 159000,
      tag: 'Hot New üî•',
      tagClass: 'bg-pink-400 text-white',
      imageUrl: 'images/letter.jpg',
      videoUrl: 'images/letter.mp4',
      detailImages: ['images/letter.mp4'],
       description: [
        "qu√©t qr sau ƒë√≥ ch·∫°m v√†o m√†n nh·∫°c s·∫Ω ƒë∆∞·ª£c ph√°t"
      ],
      features: [
        'Ch·ªØ, nh·∫°c theo y√™u c·∫ßu',
        'H·ªó tr·ª£ ch·ªânh s·ª≠a trong 24h'
      ],
    },
    {
      id: 4,
      name: 'QR V√≤ng xoay tr√°i tim',
      price: 159000,
      tag: 'Hot New üî•',
      tagClass: 'bg-pink-400 text-white',
      imageUrl: 'images/traitim.jpg',
      videoUrl: 'images/traitim.mp4',
      detailImages: ['images/traitim.mp4'],
       description: [
        "qu√©t qr sau ƒë√≥ ch·∫°m v√†o m√†n nh·∫°c s·∫Ω ƒë∆∞·ª£c ph√°t"
      ],
      features: [
        'Ch·ªØ, nh·∫°c, ·∫£nh theo y√™u c·∫ßu',
        'H·ªó tr·ª£ ch·ªânh s·ª≠a trong 24h'
      ],
    },
    {
      id: 5,
      name: 'QR Ph√°o hoa',
      price: 159000,
      tag: 'Hot New üî•',
      tagClass: 'bg-pink-400 text-white',
      imageUrl: 'images/phaohoa.jpg',
      videoUrl: 'https://i.imgur.com/T0a3aG1.mp4',
      detailImages: ['images/phaohoa.mp4'],
      description: [
        "qu√©t qr sau ƒë√≥ ch·∫°m v√†o m√†n nh·∫°c s·∫Ω ƒë∆∞·ª£c ph√°t"
      ],
      features: [
        'M·ªói c√¢u 3-4 t·ª´',
        'Ch·ªØ nh·∫°c theo y√™u c·∫ßu',
        'H·ªó tr·ª£ ch·ªânh s·ª≠a trong 24h'
      ],
    },
    {
      id: 6,
      name: 'Web t√¨nh y√™u',
      price: 159000,
      tag: 'New',
      tagClass: 'bg-gray-500 text-white',
      imageUrl: 'images/webtinhyeu.jpg',
      videoUrl: 'https://i.imgur.com/8m5g2bJ.mp4',
      detailImages: ['images/webtinhyeu.mp4'],
       description: [
        "qu√©t qr sau ƒë√≥ ch·∫°m v√†o m√†n nh·∫°c s·∫Ω ƒë∆∞·ª£c ph√°t"
      ],
      features: [
        'Ch·ªØ, nh·∫°c, ·∫£nh theo y√™u c·∫ßu',
        'H·ªó tr·ª£ ch·ªânh s·ª≠a trong 24h'
      ],
    },
  ];

  const frameProducts = [
    {
      id: 10,
      name: 'Khung ·∫£nh Polaroid',
      price: 250000,
      tag: 'New',
      tagClass: 'bg-indigo-500 text-white',
      imageUrl: 'https://picsum.photos/seed/frame1/400/500',
      videoUrl: 'https://i.imgur.com/dazwLSK.mp4',
      detailImages: ['https://picsum.photos/seed/frame1/400/500'],
      description: ['L∆∞u gi·ªØ kho·∫£nh kh·∫Øc v·ªõi khung ·∫£nh Polaroid ƒë·ªôc ƒë√°o.'],
      features: ['Ch·∫•t li·ªáu cao c·∫•p', 'In ·∫£nh s·∫Øc n√©t', 'Thi·∫øt k·∫ø t·ªëi gi·∫£n'],
    },
    {
      id: 8,
      name: 'Khung ·∫£nh Vintage',
      price: 280000,
      tag: 'Best Seller',
      tagClass: 'bg-blue-500 text-white',
      imageUrl: 'https://picsum.photos/seed/frame2/400/500',
      videoUrl: 'https://i.imgur.com/7eIqg6c.mp4',
      detailImages: ['https://picsum.photos/seed/frame2/400/500'],
      description: [
        'Khung ·∫£nh Vintage mang l·∫°i c·∫£m gi√°c ho√†i ni·ªám, ·∫•m c√∫ng.',
      ],
      features: [
        'Thi·∫øt k·∫ø c·ªï ƒëi·ªÉn',
        'Nhi·ªÅu m√†u s·∫Øc l·ª±a ch·ªçn',
        'Ph√π h·ª£p m·ªçi kh√¥ng gian',
      ],
    },
    {
      id: 9,
      name: 'Khung ·∫£nh ƒêa nƒÉng',
      price: 320000,
      tag: 'Hot üî•üî•üî•',
      tagClass: 'bg-red-500 text-white',
      imageUrl: 'https://picsum.photos/seed/frame3/400/500',
      videoUrl: 'https://i.imgur.com/3qF4zEf.mp4',
      detailImages: ['https://picsum.photos/seed/frame3/400/500'],
      description: ['Tr∆∞ng b√†y nhi·ªÅu ·∫£nh c√πng l√∫c v·ªõi khung ·∫£nh ƒëa nƒÉng.'],
      features: [
        'Ch·ª©a ƒë∆∞·ª£c 5-7 ·∫£nh',
        'Thi·∫øt k·∫ø hi·ªán ƒë·∫°i',
        'D·ªÖ d√†ng thay ƒë·ªïi ·∫£nh',
      ],
    },
  ];

// --- APP STATE (Tr·∫°ng th√°i ·ª©ng d·ª•ng) ---

let activeView = 'qr'; // 'qr' ho·∫∑c 'frame'
let selectedProduct = null;
let isMenuOpen = false;
let currentImageIndex = 0; // KH√îNG D√ôNG N·ªÆA

// --- UTILITY FUNCTION ---

// H√†m ƒë·ªãnh d·∫°ng ti·ªÅn t·ªá (VND) - GI·ªÆ L·∫†I NH∆ØNG KH√îNG D√ôNG N·ªÆA
function formatCurrency(price) {
  return price.toLocaleString('vi-VN', {
    style: 'currency',
    currency: 'VND',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0
  }).replace(/\s/g, ''); // B·ªè kho·∫£ng tr·∫Øng tr∆∞·ªõc VND
}

// --- STATE MANAGEMENT FUNCTIONS ---

function setView(view) {
  activeView = view;
  selectedProduct = null;
  isMenuOpen = false;
  renderApp();
  updateNavClasses();
}

function selectProduct(productId) {
  const allProducts = [...qrProducts, ...frameProducts];
  selectedProduct = allProducts.find(p => p.id === productId);
  currentImageIndex = 0; // KH√îNG D√ôNG N·ªÆA
  renderApp();
  window.scrollTo(0, 0);
}

function goBack() {
  selectedProduct = null;
  renderApp();
  window.scrollTo(0, 0);
}

function toggleMenu() {
  isMenuOpen = !isMenuOpen;
  const menuElement = document.getElementById('mobile-menu-sidebar');
  if (isMenuOpen) {
    menuElement.classList.remove('hidden');
  } else {
    menuElement.classList.add('hidden');
  }
}

// --- PRODUCT DETAIL CAROUSEL LOGIC (KH√îNG D√ôNG N·ªÆA) ---
function nextImage() {
  if (selectedProduct && selectedProduct.detailImages.length > 0) {
    currentImageIndex = (currentImageIndex + 1) % selectedProduct.detailImages.length;
    renderApp();
  }
}

function prevImage() {
  if (selectedProduct && selectedProduct.detailImages.length > 0) {
    currentImageIndex = (currentImageIndex - 1 + selectedProduct.detailImages.length) % selectedProduct.detailImages.length;
    renderApp();
  }
}

function setImage(index) {
  if (selectedProduct && selectedProduct.detailImages.length > index) {
    currentImageIndex = index;
    renderApp();
  }
}

// --- RENDERING FUNCTIONS ---

// Render HTML cho 1 Product Card
function renderProductCard(product) {
  // *** ƒêI·ªÄU CH·ªàNH: Lo·∫°i b·ªè hi·ªÉn th·ªã gi√° v√† d√πng object-contain cho ·∫£nh/video ***
  return `
    <div 
        class="product-card group flex flex-col bg-white rounded-2xl shadow-md overflow-hidden transition-shadow duration-300 hover:shadow-xl"
        data-product-id="${product.id}"
    >
      <div 
        class="relative w-full aspect-[3/2] cursor-pointer overflow-hidden media-container" 
        onclick="selectProduct(${product.id})"
      >
        <div class="absolute inset-0">
            <video 
                src="${product.videoUrl}" 
                class="w-full h-full object-contain video-element hidden" 
                preload="metadata"
                poster="${product.imageUrl}"
                aria-label="Video review s·∫£n ph·∫©m ${product.name}"
            >
                Your browser does not support the video tag.
            </video>
            
            <img 
                src="${product.imageUrl}" 
                alt="${product.name}" 
                class="w-full h-full object-contain image-element" 
            />
            
            </div>

        <div class="absolute top-0 left-0 p-4 w-full">
          <div class="flex flex-col items-start gap-2">
            <div 
              class="text-xs font-bold py-1.5 px-3 rounded-full ${product.tagClass}"
            >
              ${product.tag}
            </div>
            <div class="bg-black bg-opacity-50 text-white text-sm py-1.5 px-4 rounded-full backdrop-blur-sm flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
              </svg>
              <span>Video</span>
            </div>
          </div>
        </div>
      </div>

      <div class="p-4 flex flex-col items-center text-center gap-3">
        <h3 class="font-bold text-lg text-slate-800">${product.name}</h3>
        <div class="flex items-center gap-3 mt-1">
          <button 
            onclick="selectProduct(${product.id})"
            class="bg-white border border-slate-700 text-slate-700 hover:bg-slate-100 text-sm font-semibold py-2 px-6 rounded-lg transition-colors">
              Xem video m·∫´u
          </button>
          <a href="https://zalo.me/0359369930" class="bg-slate-800 text-white hover:bg-slate-900 text-sm font-semibold py-2 px-6 rounded-lg transition-colors">
            Li√™n h·ªá
          </a>
        </div>
      </div>
    </div>
  `;
}

// Render HTML cho Product Detail (ƒê√É CHUY·ªÇN TH√ÄNH VIDEO DUY NH·∫§T)
function renderProductDetail() {
  if (!selectedProduct) return '';

  const product = selectedProduct;

  const descriptionHtml = product.description.map(line => `<p>${line}</p>`).join('');
  const featuresHtml = product.features.map(feature => `
    <li class="flex items-center gap-3">
      <svg class="h-6 w-6 text-green-500 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
      </svg>
      <span class="text-slate-600">${feature}</span>
    </li>
  `).join('');

  // *** ƒêI·ªÄU CH·ªàNH: T·ªâ l·ªá khung h√¨nh aspect-[9/16] v√† object-contain ***
  return `
    <section class="py-12 md:py-20">
      <div class="mb-8">
        <button onclick="goBack()" class="text-slate-600 hover:text-slate-900 flex items-center gap-2">
           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
          </svg>
          <span>Tr·ªü l·∫°i</span>
        </button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-12 lg:gap-16">
        <div id="product-image-carousel" class="relative w-full aspect-[9/16] md:aspect-[9/16] overflow-hidden rounded-2xl shadow-lg">
          
          <video 
            src="${product.videoUrl}" 
            class="w-full h-full object-contain"
            autoplay muted loop playsinline controls
            poster="${product.imageUrl}"
            aria-label="Video gi·ªõi thi·ªáu s·∫£n ph·∫©m ${product.name}"
          >
            Your browser does not support the video tag.
          </video>
          </div>

        <div class="flex flex-col">
          <h1 class="text-3xl lg:text-4xl font-bold text-slate-900">${product.name}</h1>
          
          <div class="mt-6 text-slate-600 space-y-3 leading-relaxed">
            ${descriptionHtml}
          </div>

          <div class="mt-8">
            <h3 class="font-bold text-lg text-slate-800 mb-4">ƒê·∫∑c ƒëi·ªÉm n·ªïi b·∫≠t</h3>
            <ul class="space-y-3">
              ${featuresHtml}
            </ul>
          </div>

          <div class="mt-auto pt-10">
            <a href="#" class="w-full bg-slate-800 text-white hover:bg-slate-900 font-semibold py-4 px-8 rounded-lg transition-colors text-center block">
              Li√™n h·ªá ngay
            </a>
          </div>
        </div>
      </div>
    </section>
  `;
}


// --- MAIN APPLICATION RENDERING ---

function renderApp() {
  const mainContent = document.getElementById('main-content');
  let htmlContent = '';

  if (selectedProduct) {
    // Render Product Detail
    htmlContent = renderProductDetail();
  } else {
    // Render Hero and Product List
    const currentProducts = activeView === 'qr' ? qrProducts : frameProducts;
    
    // Hero Section
    if (activeView === 'qr') {
      htmlContent += `
        <section class="text-center py-16 md:py-24 px-4">
          <h1 class="text-5xl md:text-7xl text-slate-900 tracking-wider">
            A <span class="font-dancing-script text-6xl md:text-8xl">Gift</span>
            FOR YOU
          </h1>
          <p class="max-w-2xl mx-auto mt-6 text-gray-500 leading-relaxed">
            DN GIFTS SHOP ‚Äì N∆°i c·∫£m x√∫c ƒë∆∞·ª£c g·ª≠i g·∫Øm qua t·ª´ng m√≥n qu√†. T·ª´ khung
            ·∫£nh thi·∫øt k·∫ø ri√™ng, h√¨nh n·ªÅn QR t√¨nh y√™u, m·ªói
            m√≥n qu√† ƒë·ªÅu ƒë∆∞·ª£c t·∫°o n√™n ƒë·ªÉ thay b·∫°n n√≥i l·ªùi th∆∞∆°ng, g·ª≠i ƒëi·ªÅu kh√≥ n√≥i,
            v√† khi·∫øn ai ƒë√≥ c·∫£m th·∫•y m√¨nh th·∫≠t ƒë·∫∑c bi·ªát.
          </p>
        </section>
      `;
    }
    
    // Products Section
    const productCardsHtml = currentProducts.map(renderProductCard).join('');

    // ƒê√£ ch·ªânh grid layout th√†nh lg:grid-cols-3
    htmlContent += `
      <section class="pb-24 pt-8">
        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12"
          id="product-grid"
        >
          ${productCardsHtml}
        </div>
      </section>
    `;
  }
  
  mainContent.innerHTML = htmlContent;

  // G·∫Øn l·∫°i logic hover sau khi DOM ƒë∆∞·ª£c c·∫≠p nh·∫≠t
  attachHoverListeners();
}


// --- HOVER LOGIC (ƒê√É B·ªé LOGIC SPINNER V√Ä LOADING) ---

function attachHoverListeners() {
  const productCards = document.querySelectorAll('.product-card');

  productCards.forEach(card => {
    // X√ìA to√†n b·ªô logic hover/mouseleave ƒë·ªÉ kh√¥ng ph√°t video khi r√™ chu·ªôt 
    
    // G·ª° b·ªè event listener c≈© n·∫øu c√≥ (ƒë·ªÉ tr√°nh l·∫∑p)
    card.removeEventListener('mouseenter', card.mouseenterHandler);
    card.removeEventListener('mouseleave', card.mouseleaveHandler);
    
  });
}

// --- NAVIGATION CLASS UPDATER ---

function updateNavClasses() {
  const qrBtnDesktop = document.getElementById('qr-view-btn-desktop');
  const frameBtnDesktop = document.getElementById('frame-view-btn-desktop');

  if (qrBtnDesktop) {
    qrBtnDesktop.className = `font-medium transition-colors ${
      activeView === 'qr'
        ? 'text-slate-900 border-b-2 border-slate-900'
        : 'text-slate-600 hover:text-slate-900'
    }`;
  }

  if (frameBtnDesktop) {
    frameBtnDesktop.className = `font-medium transition-colors ${
      activeView === 'frame'
        ? 'text-slate-900 border-b-2 border-slate-900'
        : 'text-slate-600 hover:text-slate-900'
    }`;
  }
}

// --- INITIALIZATION ---

document.addEventListener('DOMContentLoaded', () => {
  renderApp(); // Render the initial view
  updateNavClasses(); // Set initial navigation highlights
});